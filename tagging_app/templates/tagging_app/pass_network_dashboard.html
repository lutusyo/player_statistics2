{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html>
<head>
    <title>Pass Network Matrix</title>
    <style>
        table, th, td {
            border: 1px solid #aaa;
            border-collapse: collapse;
            text-align: center;
            padding: 6px;
        }
        th {
            background: #f0f0f0;
        }
        td.black-cell {
            background: #000;
        }
    </style>
</head>
<body>
    <h2>Passing Networks</h2>
    <p>{{ match.date }} - {{ match.stadium }} - {{ match.kickoff }}</p>

    <table>
        <thead>
            <tr>
                <th>Passes From â†’ To</th>
                {% for p in players %}
                    <th>{{ p.name|slice:":10" }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row_player in players %}
            <tr>
                <th>{{ row_player.name|slice:":10" }}</th>
                {% for col_player in players %}
                    {% if row_player.id == col_player.id %}
                        <td class="black-cell"></td>
                    {% else %}
                        <td>
                            {{ matrix|get_item:row_player.id|get_item:col_player.id|default:"0" }}
                        </td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Top 5 Player to Player Passers</h3>
    <table>
        <tr>
            <th>Player</th>
            <th>Passed To</th>
            <th># Passes</th>
        </tr>
        {% for from_name, to_name, count in top_combinations %}
        <tr>
            <td>{{ from_name }}</td>
            <td>{{ to_name }}</td>
            <td>{{ count }}</td>
        </tr>
        {% endfor %}
    </table>

    <a href="{% url 'tagging_app:export_pass_network_pdf' match.id %}">Download PDF</a> |
    <a href="{% url 'tagging_app:export_pass_network_csv' match.id %}">Download CSV</a>
</body>
</html>
