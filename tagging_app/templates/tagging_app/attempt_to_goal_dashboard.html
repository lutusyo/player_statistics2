{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Attempt to Goal Dashboard{% endblock %}

{% block content %}
<h1>Match: {{ match }}</h1>

<h2>Top 5 Goal Scorers</h2>
<ul>
  {% for player, goals in top_scorers %}
    <li><strong>{{ player }}</strong>: {{ goals }} goal{{ goals|pluralize }}</li>
  {% empty %}
    <li>No goals recorded</li>
  {% endfor %}
</ul>

<hr>

<h2>Attempts by Outcome per Player</h2>
<table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%;">
  <thead>
    <tr>
      <th>Player</th>
      <th>Goal</th>
      <th>Miss</th>
      <th>Saved</th>
      <th>Post</th>
    </tr>
  </thead>
  <tbody>
    {% for player in players %}
      <tr>
        <td>{{ player.name }}</td>
        <td>{{ outcomes_matrix|get_item:player.id|get_item:"Goal"|default:0 }}</td>
        <td>{{ outcomes_matrix|get_item:player.id|get_item:"Miss"|default:0 }}</td>
        <td>{{ outcomes_matrix|get_item:player.id|get_item:"Saved"|default:0 }}</td>
        <td>{{ outcomes_matrix|get_item:player.id|get_item:"Post"|default:0 }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<hr>

<h2>Goals per Player Chart</h2>
<canvas id="goalsChart" width="600" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('goalsChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [{% for player, goals in top_scorers %}'{{ player }}',{% endfor %}],
      datasets: [{
        label: 'Goals',
        data: [{% for player, goals in top_scorers %}{{ goals }},{% endfor %}],
        backgroundColor: 'rgba(54, 162, 235, 0.7)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1,
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          precision: 0
        }
      }
    }
  });
</script>

{% endblock %}
