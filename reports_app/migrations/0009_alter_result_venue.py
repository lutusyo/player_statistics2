# Generated by Django 5.2.1 on 2025-11-15

import django.db.models.deletion
from django.db import migrations, models


def clear_old_result_venue_values(apps, schema_editor):
    """Remove old text values so FK migration does not fail."""
    Result = apps.get_model('reports_app', 'Result')
    Result.objects.update(venue=None)


class Migration(migrations.Migration):

    dependencies = [
        ('matches_app', '0009_region_venue_alter_match_venue'),
        ('reports_app', '0008_alter_result_venue'),
    ]

    operations = [

        # Step 1 — temporarily allow venue to be CharField and nullable
        migrations.AlterField(
            model_name='result',
            name='venue',
            field=models.CharField(max_length=255, null=True, blank=True),
        ),

        # Step 2 — clear existing text venue values
        migrations.RunPython(clear_old_result_venue_values),

        # Step 3 — now safely convert to ForeignKey
        migrations.AlterField(
            model_name='result',
            name='venue',
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                to='matches_app.venue',
            ),
        ),
    ]
