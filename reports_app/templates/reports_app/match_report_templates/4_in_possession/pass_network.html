{% load static %}
{% load tagging_custom_filters %}
{% load custom_filters %}

<!DOCTYPE html>
<html>
<head>
  <title>Pass Network Dashboard</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f8f9fa;
        padding: 20px;
    }

    h1, h2 {
        text-align: center;
        color: #007bff;
        margin-top: 40px;
    }

    table {
        width: 90%;
        margin: 20px auto;
        border-collapse: collapse;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
    }

    th {
        background: #007bff;
        color: #fff;
    }

    tr:nth-child(even) { background: #f2f2f2; }

    .team-section {
        margin-bottom: 80px;
    }

    .chart-container {
        width: 80%;
        max-width: 700px;
        margin: 30px auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>

<h1>Pass Network Dashboard</h1>

<!-- ================= HOME TEAM ================= -->
<div class="team-section">
  <h2>{{ home_team.name }} – Pass Data</h2>

  <!-- Pass Matrix -->
  <h3>Pass Matrix</h3>
  <table>
    <tr>
      <th>From\To</th>
      {% for p in home_pass.players %}
        <th>{{ home_pass.player_names|get_item:p.id|slice:":10" }}</th>
      {% endfor %}
    </tr>

    {% for row in home_pass.players %}
    <tr>
      <th>{{ home_pass.player_names|get_item:row.id|slice:":10" }}</th>
      {% for col in home_pass.players %}
        {% if row.id == col.id %}
          <td>—</td>
        {% else %}
          <td>{{ home_pass.matrix|get_item:row.id|get_item:col.id|default:"0" }}</td>
        {% endif %}
      {% endfor %}
    </tr>
    {% endfor %}
  </table>

  <!-- Player Totals -->
  <h3>Player Passing Totals</h3>
  <table>
    <tr><th>Player</th><th>Total Passes</th><th>Ball Lost</th></tr>
    {% for p in home_pass.players %}
    <tr>
      <td>{{ home_pass.player_names|get_item:p.id }}</td>
      <td>{{ home_pass.total_passes|get_item:p.id|default:"0" }}</td>
      <td>{{ home_pass.ball_lost|get_item:p.id|default:"0" }}</td>
    </tr>
    {% endfor %}
  </table>

  <!-- Top Combinations -->
  <h3>Top 5 Pass Combinations</h3>
  <table>
    <tr><th>From</th><th>To</th><th>Count</th></tr>
    {% for f, t, c in home_pass.top_combinations %}
      <tr><td>{{ f }}</td><td>{{ t }}</td><td>{{ c }}</td></tr>
    {% endfor %}
  </table>

  <!-- Chart -->
  <div class="chart-container">
    <canvas id="homePassChart"></canvas>
  </div>
</div>

<!-- ================= AWAY TEAM ================= -->
<div class="team-section">
  <h2>{{ away_team.name }} – Pass Data</h2>

  <!-- Pass Matrix -->
  <h3>Pass Matrix</h3>
  <table>
    <tr>
      <th>From\To</th>
      {% for p in away_pass.players %}
        <th>{{ away_pass.player_names|get_item:p.id|slice:":10" }}</th>
      {% endfor %}
    </tr>

    {% for row in away_pass.players %}
    <tr>
      <th>{{ away_pass.player_names|get_item:row.id|slice:":10" }}</th>
      {% for col in away_pass.players %}
        {% if row.id == col.id %}
          <td>—</td>
        {% else %}
          <td>{{ away_pass.matrix|get_item:row.id|get_item:col.id|default:"0" }}</td>
        {% endif %}
      {% endfor %}
    </tr>
    {% endfor %}
  </table>

  <!-- Player Totals -->
  <h3>Player Passing Totals</h3>
  <table>
    <tr><th>Player</th><th>Total Passes</th><th>Ball Lost</th></tr>
    {% for p in away_pass.players %}
    <tr>
      <td>{{ away_pass.player_names|get_item:p.id }}</td>
      <td>{{ away_pass.total_passes|get_item:p.id|default:"0" }}</td>
      <td>{{ away_pass.ball_lost|get_item:p.id|default:"0" }}</td>
    </tr>
    {% endfor %}
  </table>

  <!-- Top Combinations -->
  <h3>Top 5 Pass Combinations</h3>
  <table>
    <tr><th>From</th><th>To</th><th>Count</th></tr>
    {% for f, t, c in away_pass.top_combinations %}
      <tr><td>{{ f }}</td><td>{{ t }}</td><td>{{ c }}</td></tr>
    {% endfor %}
  </table>

  <!-- Chart -->
  <div class="chart-container">
    <canvas id="awayPassChart"></canvas>
  </div>
</div>

<!-- ================= CHART JS ================= -->
<script>
function drawChart(canvasId, labels, values) {
    new Chart(document.getElementById(canvasId), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: 'rgba(54,162,235,0.7)'
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });
}

drawChart(
  "homePassChart",
  {{ home_pass.chart_data.names|safe }},
  {{ home_pass.chart_data.values|safe }}
);

drawChart(
  "awayPassChart",
  {{ away_pass.chart_data.names|safe }},
  {{ away_pass.chart_data.values|safe }}
);
</script>

</body>
</html>
