{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        padding: 8px;
        border: 1px solid #ddd;
        text-align: center;
    }
    .starter-checkbox:checked + label::after {
        content: "‚≠ê";  /* star icon */
        color: green;
        margin-left: 5px;
    }
    .sub-checkbox:checked + label::after {
        content: "‚Ü∫";  /* reload/rotate arrow icon */
        color: blue;
        margin-left: 5px;
    }
    .bench-checkbox:checked + label::after {
        content: "‚òë";  /* checkbox icon */
        color: gray;
        margin-left: 5px;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form');
        form.addEventListener('submit', function (e) {
            const starterCheckboxes = document.querySelectorAll('input[name$="-is_starting"]');
            let starterCount = 0;
            starterCheckboxes.forEach(cb => {
                if (cb.checked) starterCount++;
            });
            if (starterCount > 11) {
                alert("You can only select a maximum of 11 Starting players.");
                e.preventDefault();
            }
        });
    });
</script>
{% endblock %}

{% block content %}
<h2>Lineup for {{ match }}</h2>
<a href="/admin/matches_app/match/" style="margin-bottom: 20px; display: inline-block;">&larr; Back to Matches</a>

<form method="post">{% csrf_token %}
  {{ formset.management_form }}
  <table>
    <thead>
      <tr>
        <th>Player</th>
        <th>Position</th>
        <th>Pod Number</th>
        <th>Starter ‚≠ê</th>
        <th>Sub üîÑ</th>
        <th>Bench ‚òëÔ∏è</th>
        <th>Time Entered</th>
      </tr>
    </thead>
    <tbody>
      {% for form in formset %}
      <tr>
        <td>{{ form.player }}</td>
        <td>{{ form.position }}</td>
        <td>{{ form.pod_number }}</td>
        <td>
          <input type="radio" name="{{ form.prefix }}-role" value="starter" id="{{ form.prefix }}-starter" class="starter-checkbox"
            {% if form.instance.is_starting %} checked {% endif %}>
          <label for="{{ form.prefix }}-starter"></label>
        </td>
        <td>
          <input type="radio" name="{{ form.prefix }}-role" value="sub" id="{{ form.prefix }}-sub" class="sub-checkbox"
            {% if not form.instance.is_starting and form.instance.time_entered %} checked {% endif %}>
          <label for="{{ form.prefix }}-sub"></label>
        </td>
        <td>
          <input type="radio" name="{{ form.prefix }}-role" value="bench" id="{{ form.prefix }}-bench" class="bench-checkbox"
            {% if not form.instance.is_starting and not form.instance.time_entered %} checked {% endif %}>
          <label for="{{ form.prefix }}-bench"></label>
        </td>
        <td>{{ form.time_entered }}</td>
      </tr>
      {% if form.errors %}
      <tr>
        <td colspan="7" style="color: red; text-align: left;">
          <ul>
            {% for field, errors in form.errors.items %}
              <li><strong>{{ field }}:</strong> {{ errors|join:", " }}</li>
            {% endfor %}
            {% if form.non_field_errors %}
              <li><strong>Errors:</strong> {{ form.non_field_errors|join:", " }}</li>
            {% endif %}
          </ul>
        </td>
      </tr>
      {% endif %}
      {% endfor %}
    </tbody>
  </table>
  <button type="submit" class="default">Save Lineup</button>
</form>

{% endblock %}